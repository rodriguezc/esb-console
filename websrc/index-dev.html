<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ESB-CONSOLE</title>
    <link rel="stylesheet" href="esb-console/widget/css/all.css"/>
    <link rel="stylesheet" href="dijit/themes/claro/claro.css"/>
    <link rel="stylesheet" href="gridx/resources/claro/Gridx.css"/>

</head>

<body class="claro">
<div id="bodyContent"  data-dojo-type="dijit/layout/ContentPane" style="width:100%;height: 100%;margin: 0;padding: 0"></div>
<script src="dojo/dojo.js" data-dojo-config="async: false, isDebug: true"></script>
<script type="text/javascript">

        require([
            "dojo/parser",
            "esb-console/widget/IndexWidget",
            "dojo/topic",
            "dojo/hash",
            "dojo/io-query",
            "dojo/domReady!"
        ], function (parser, IndexWidget, topic,hash,ioQuery) {
            parser.parse();
            var indexWidget = new IndexWidget();
            indexWidget.placeAt("bodyContent");

            topic.subscribe("/dojo/hashchange", function(changedHash){
                var hashObj = ioQuery.queryToObject(changedHash);
                var env = hashObj.env;
                var page = hashObj.page;
                var broker = hashObj.broker;
                var queue = hashObj.queue;
                if(page != null) {
                    topic.publish("menu/pageSelected", env, page, broker);
                }

                if(queue != null) {
                    indexWidget.mainDataPromise.then(function(){
                        topic.publish("hermes/queueSelected", env, page, broker, queue);
                    });
                }
            });

            if(hash()) {
                topic.publish("/dojo/hashchange", hash());
            }
        });
</script>
</body>
</html>

